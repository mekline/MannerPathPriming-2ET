###############################
# THE SCRIPT
###############################
#
# Put description here
#
###############################
# Preliminaries
###############################
#Run these two lines the first time only to install eyetrackingR
#install.packages("devtools")
#devtools::install_github("jwdink/eyetrackingR")
library("eyetrackingR")
library("plyr")
library("dplyr")
library("lme4")
library("ggplot2")
library("Matrix")
library("tidyr")
library("stringr")
kids_to_process <- c('child_pilot_0306',
'child_pilot_0314',
'child_pilot_03162018',
'child_pilot_03202018',
'pilot x2')
#Set your directories
myRepo = '/Users/mekline/Dropbox/_Projects/MannerPath-2ET/MannerPathPriming-2ET Repo'
analysisDir = paste(myRepo, '/Analysis/Analysis_Pilot3/',sep='')
dataDir = paste(myRepo, '/Data/Pilot 3/',sep='')
setwd(myRepo)
###############################
# LOAD DATA
###############################
#load participantdata
pData <- read.csv('all_participants_MPP2ET.csv')
pData <- pData %>%
filter(SubjectID %in% kids_to_process)
#Load data for all participants from their data folders
DatData <- data.frame(NULL)
TimestampData <- data.frame(NULL)
GazeData <- data.frame(NULL)
for(ID in pData$SubjectID){
myDataDir <- paste(dataDir, ID, '/', sep='')
setwd(myDataDir)
print(ID)
myDatFile <- paste('data_MPPCREATION_',ID, '.dat', sep='')
myTimestampFile <- paste('timestamps_MPPCREATION_',ID,'.csv',sep='')
myMainGazeFiles <- list.files(path = myDataDir, full.names = TRUE, pattern = ".*\\Main_.*.csv")
myPracticeGazeFiles <- list.files(path = myDataDir, full.names = TRUE, pattern = ".*\\Practice_.*.csv")
myDatData <- read.csv(myDatFile)
myTimestampData <- read.csv(myTimestampFile)
myGazeData <- data.frame(NULL)
for (f in myMainGazeFiles){
thisGazeData = read.csv(f)
thisGazeData$filename = f
thisGazeData$phaseGaze = 'Main'
if(nrow(myGazeData) == 0) {
myGazeData = thisGazeData
} else{
myGazeData = bind_rows(myGazeData, thisGazeData)
}
}
for (f in myPracticeGazeFiles){
thisGazeData = read.csv(f)
thisGazeData$filename = f
thisGazeData$phaseGaze = 'Practice'
myGazeData = bind_rows(myGazeData, thisGazeData)
}
#Add everything to the big DFs!
if (nrow(DatData) == 0){ #special case for 1st round
DatData = myDatData
TimestampData = myTimestampData
GazeData = myGazeData
} else {
DatData = bind_rows(DatData, myDatData)
TimestampData = bind_rows(TimestampData, myTimestampData)
GazeData = bind_rows(GazeData, myGazeData)
}
}
###############################
# PROCESS/RECODE DATA
###############################
TimestampData <- TimestampData %>%
mutate(system_time_stamp = system_time_stamp - 1500000000000000) %>%
mutate(point_description = ifelse(str_count(point_description, "Practice"),
point_description,
paste("Main_", point_description, sep="")))%>%
separate(point_description, c("phaseTimestamp", "trialNo", "description"), extra = 'merge', remove = FALSE)
GazeData <- GazeData %>%
mutate(system_time_stamp = system_time_stamp - 1500000000000000)%>%
mutate(SubjectID = subjectID)
DatData <- DatData %>%
select(c("SubjectNo","Date","Time","VerbDomain","Condition","trialNo","itemID" ,"verbName","verbMeaning",
"mannerSideBias", "pathSideBias","mannerSideTest", "pathSideTest")) %>%
mutate_if(is.factor, as.character) %>%
mutate(SubjectID = SubjectNo) %>%
mutate(itemID = as.character(itemID))%>%
select(-SubjectNo) %>%
mutate(phaseDat = 'Main') %>%
mutate(targetSideBias = ifelse(Condition == 'Manner', mannerSideBias,pathSideBias)) %>%
mutate(targetSideTest = ifelse(Condition == 'Manner', mannerSideTest, pathSideTest))
#Manually add Pratice lines to the Dat files - parameters always the same! Target on the right for trial 1, target on left for trial 2 (not used)
pract <- DatData %>%
group_by(SubjectID)%>%
summarise_all(first)%>%
mutate(trialNo = 0, itemID = 'practice', verbName = 'NA',
verbMeaning = 'ball', mannerSideBias = 'NA', pathSideBias = 'NA',
mannerSideTest = 'NA', pathSideTest = 'NA', targetSideBias = 'NA', targetSideTest = 'R')
DatData <- bind_rows(DatData, pract)
###############################
# MERGE DATA (ahhhh!)
###############################
AllSubjData <- merge(DatData, pData, by="SubjectID")
#Put timestamps all over GazeData
startTime <- TimestampData %>%
group_by(subjectID) %>%
summarize_all(first)%>%
select(subjectID, system_time_stamp)%>%
mutate(expStartTime = system_time_stamp) %>%
select(-system_time_stamp)
GazeData <- GazeData %>%
select(-SubjectID)
names(GazeData)
names(startTime)
merge(GazeData, startTime, by=c("subjectID"))
nrow(GazeData)
save(GazeData, "mergedGazeData")
help(sage)
help(save)
save(GazeData, "GazeData.RData")
save(GazeData, file = "GazeData.RData")
practiceSubjData = filter(AllSubjData, SubjectID == 'child_pilot_03202018')
practiceTimestampData = filter(TimestampData, subjectID == 'child_pilot_03202018')
practiceGazeData = filter(GazeData, subjectID == 'child_pilot_03202018')
View(practiceGazeData)
GazeData = merge(GazeData, startTime, by=c("subjectID"))
practiceSubjData = filter(AllSubjData, SubjectID == 'child_pilot_03202018')
practiceTimestampData = filter(TimestampData, subjectID == 'child_pilot_03202018')
practiceGazeData = filter(GazeData, subjectID == 'child_pilot_03202018')
View(practiceGazeData)
TimestampData = merge(TimestampData, startTime, by = c("subjectID"))
practiceTimestampData = filter(TimestampData, subjectID == 'child_pilot_03202018')
practiceGazeDataLine = practiceGazeData[3]
View(practiceGazeDataLine)
practiceGazeDataLine = practiceGazeData[,3]
View(practiceGazeDataLine)
practiceGazeDataLine = practiceGazeData[3,]
View(practiceGazeDataLine)
TimestampData$sdjusted_time <- TimestampData$system_time_stamp - TimestampData$expStartTime
GazeData$sdjusted_time <- Gaze$system_time_stamp - GazeData$expStartTime
GazeData$sdjusted_time <- GazeData$system_time_stamp - GazeData$expStartTime
practiceSubjData = filter(AllSubjData, SubjectID == 'child_pilot_03202018')
practiceTimestampData = filter(TimestampData, subjectID == 'child_pilot_03202018')
practiceGazeData = filter(GazeData, subjectID == 'child_pilot_03202018')
practiceGazeDataLine = practiceGazeData[3,]
View(practiceGazeDataLine)
